# SmartRecycle Oracle Cloud Backend Setup Guide

This guide will help you set up the Oracle Cloud Infrastructure (OCI) backend for your SmartRecycle application.

## 🏗️ Oracle Cloud Services Required

### 1. Oracle Autonomous Database
- **Service**: Always Free Autonomous Transaction Processing (ATP)
- **Purpose**: Store users, materials, collections, and analytics data
- **Configuration**: 1 OCPU, 20GB storage

### 2. Oracle Compute Instance
- **Service**: Always Free VM.Standard.E2.1.Micro
- **Purpose**: Host Node.js/Express backend API
- **Configuration**: 1 OCPU, 1GB RAM, Ubuntu 22.04

### 3. Oracle Object Storage
- **Service**: Always Free Object Storage
- **Purpose**: Store material images and documents
- **Configuration**: 10GB free storage

### 4. Oracle API Gateway
- **Service**: API Gateway
- **Purpose**: Route and secure API requests
- **Configuration**: RESTful API endpoints

### 5. Oracle AI Services (Optional)
- **Service**: Vision AI, AI Language
- **Purpose**: Classify materials and analyze content
- **Configuration**: Pay-per-use for advanced features

## 🚀 Quick Setup Steps

### Step 1: Create Oracle Cloud Account
1. Visit [Oracle Cloud](https://cloud.oracle.com)
2. Sign up for Always Free account
3. Verify your email and phone number
4. Complete identity verification

### Step 2: Set Up Autonomous Database
```sql
-- Create tables for SmartRecycle
CREATE TABLE users (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email VARCHAR2(255) UNIQUE NOT NULL,
    password_hash VARCHAR2(255) NOT NULL,
    name VARCHAR2(255) NOT NULL,
    role VARCHAR2(50) DEFAULT 'user',
    status VARCHAR2(50) DEFAULT 'pending',
    location VARCHAR2(500),
    phone VARCHAR2(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE materials (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id NUMBER REFERENCES users(id),
    type VARCHAR2(100) NOT NULL,
    weight NUMBER(10,2) NOT NULL,
    description CLOB,
    location VARCHAR2(500) NOT NULL,
    contact_info VARCHAR2(500),
    status VARCHAR2(50) DEFAULT 'available',
    image_url VARCHAR2(1000),
    ai_classification VARCHAR2(100),
    ai_confidence NUMBER(5,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE collections (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    material_id NUMBER REFERENCES materials(id),
    collector_id NUMBER REFERENCES users(id),
    status VARCHAR2(50) DEFAULT 'claimed',
    claimed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    collected_at TIMESTAMP,
    notes CLOB,
    rating NUMBER(1) CHECK (rating BETWEEN 1 AND 5),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE ai_classifications (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    material_id NUMBER REFERENCES materials(id),
    classification_type VARCHAR2(100),
    confidence NUMBER(5,2),
    biodegradable CHAR(1) CHECK (biodegradable IN ('Y', 'N')),
    recyclable CHAR(1) CHECK (recyclable IN ('Y', 'N')),
    hazardous CHAR(1) CHECK (hazardous IN ('Y', 'N')),
    processed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Step 3: Deploy Backend to Compute Instance
```bash
# Connect to your OCI Compute instance
ssh -i your-private-key.pem ubuntu@your-instance-ip

# Install Node.js and npm
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# Clone and setup backend
git clone https://github.com/yourusername/smartrecycle-backend.git
cd smartrecycle-backend
npm install

# Install Oracle Instant Client
wget https://download.oracle.com/otn_software/linux/instantclient/1919000/instantclient-basic-linux.x64-19.19.0.0.0dbru.zip
sudo unzip instantclient-basic-linux.x64-19.19.0.0.0dbru.zip -d /opt/oracle
export LD_LIBRARY_PATH=/opt/oracle/instantclient_19_19:$LD_LIBRARY_PATH

# Configure environment variables
cp .env.example .env
# Edit .env with your Oracle Cloud credentials

# Start the application
npm start
```

### Step 4: Configure Object Storage
```javascript
// Backend: Object Storage configuration
const oci = require('oci-sdk');

const provider = new oci.common.ConfigFileAuthenticationDetailsProvider();
const objectStorageClient = new oci.objectstorage.ObjectStorageClient({
    authenticationDetailsProvider: provider
});

// Upload material image
async function uploadMaterialImage(bucketName, objectName, imageData) {
    const request = {
        bucketName: bucketName,
        putObjectBody: imageData,
        objectName: objectName,
        contentType: 'image/jpeg'
    };
    
    return await objectStorageClient.putObject(request);
}
```

## 🔧 Environment Configuration

Create a `.env` file in your React app root directory:

```env
# Oracle Cloud Infrastructure Configuration
REACT_APP_OCI_REGION=us-ashburn-1
REACT_APP_OCI_COMPARTMENT_ID=ocid1.compartment.oc1..your_compartment_id
REACT_APP_OCI_TENANCY_ID=ocid1.tenancy.oc1..your_tenancy_id

# Backend API Configuration
REACT_APP_API_BASE_URL=https://your-oci-compute-instance.us-ashburn-1.oci.customer-oci.com
REACT_APP_API_VERSION=v1

# Oracle Autonomous Database Configuration
REACT_APP_DB_CONNECTION_STRING=your_autonomous_db_connection
REACT_APP_DB_SERVICE_NAME=your_service_name_high

# Oracle Object Storage Configuration  
REACT_APP_OBJECT_STORAGE_NAMESPACE=your_namespace
REACT_APP_OBJECT_STORAGE_BUCKET=smartrecycle-materials

# Oracle Cloud Functions Configuration
REACT_APP_FUNCTIONS_ENDPOINT=https://your-functions-endpoint.us-ashburn-1.functions.oci.oraclecloud.com

# AI/ML Service Configuration (Oracle AI Services)
REACT_APP_AI_SERVICE_ENDPOINT=https://your-ai-service.us-ashburn-1.oci.oraclecloud.com
REACT_APP_VISION_SERVICE_ENDPOINT=https://vision.aiservice.us-ashburn-1.oci.oraclecloud.com
```

## 📱 Frontend Integration

The frontend is already configured to use Oracle Cloud services. Here's how each service is integrated:

### Authentication with Oracle Cloud
```javascript
import authService from '../services/authService';

// Login with Oracle Cloud backend
const handleLogin = async (email, password, role) => {
    const result = await authService.login(email, password, role);
    if (result.success) {
        // User authenticated successfully
        navigate('/dashboard');
    }
};
```

### Material Management
```javascript
import materialService from '../services/materialService';

// Fetch materials from Oracle Autonomous Database
const loadMaterials = async () => {
    const result = await materialService.getAvailableMaterials();
    if (result.success) {
        setMaterials(result.data);
    }
};

// Upload image to Oracle Object Storage
const handleImageUpload = async (file) => {
    const result = await materialService.uploadMaterialImage(materialId, file);
    if (result.success) {
        setImageUrl(result.data.url);
    }
};
```

## 🔒 Security Configuration

### API Gateway Security
```yaml
# api-gateway-policy.yaml
security:
  authentication:
    type: "JWT"
    tokenHeader: "Authorization"
    tokenPattern: "Bearer {token}"
  
  rate-limiting:
    requests-per-minute: 100
    burst-limit: 20
```

### Database Security
- Enable wallet-based authentication
- Use SSL/TLS encryption
- Configure VCN security lists
- Set up IAM policies for least privilege access

## 🎯 Testing the Integration

### 1. Test API Connectivity
```bash
curl -X GET "https://your-api-gateway.us-ashburn-1.oci.customer-oci.com/api/v1/system/health"
```

### 2. Test Database Connection
```javascript
// Test database connectivity
const testDbConnection = async () => {
    try {
        const result = await api.get('/api/v1/system/health');
        console.log('Database Status:', result.data.database);
    } catch (error) {
        console.error('Database connection failed:', error);
    }
};
```

### 3. Test Object Storage
```javascript
// Test file upload
const testFileUpload = async () => {
    const file = new File(['test'], 'test.jpg', { type: 'image/jpeg' });
    const result = await materialService.uploadMaterialImage(1, file);
    console.log('Upload Status:', result.success);
};
```

## 📊 Monitoring and Analytics

### Oracle Cloud Monitoring
- Set up alarms for API response times
- Monitor database performance
- Track Object Storage usage
- Configure notification channels

### Application Insights
```javascript
// Built-in analytics tracking
import { trackEvent } from '../utils/analytics';

trackEvent('material_claimed', {
    materialType: 'PET Bottles',
    weight: 5.2,
    location: 'Mumbai'
});
```

## 🚨 Troubleshooting

### Common Issues:
1. **Database Connection Failed**: Check TNS names and wallet configuration
2. **API Gateway 403**: Verify IAM policies and authentication
3. **Object Storage Access Denied**: Check bucket policies and compartment access
4. **AI Service Timeout**: Verify region availability and quotas

### Debug Mode:
Enable debug logging by setting:
```env
REACT_APP_DEBUG=true
```

This will show detailed API request/response logs in the browser console.

## 🎉 Production Deployment

### Final Checklist:
- [ ] Autonomous Database configured and tested
- [ ] Compute instance deployed with backend API
- [ ] Object Storage bucket created and accessible
- [ ] API Gateway configured with proper security
- [ ] Environment variables configured
- [ ] SSL certificates installed
- [ ] Monitoring and alerts set up
- [ ] Backup strategy implemented

## 📞 Support

For Oracle Cloud specific issues:
- [Oracle Cloud Documentation](https://docs.oracle.com/en-us/iaas/)
- [Oracle Cloud Support](https://support.oracle.com)
- [Oracle Cloud Community](https://cloudcustomerconnect.oracle.com)

For application issues:
- Check browser console for detailed error logs
- Review API response codes and messages
- Use Oracle Cloud monitoring for infrastructure issues 